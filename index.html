<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>108Ë™≤Á∂±Â≠∏Ê∏¨ÂÖ¨Ê∞ëÊ®°Êì¨App</title>
    <!-- ÂºïÂÖ• React Âíå ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- ÂºïÂÖ• Babel Áî®ÊñºËß£Êûê JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- ÂºïÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@600&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-100 h-screen w-full flex justify-center items-center overflow-hidden">
    <div id="root" class="w-full h-full max-w-md bg-white shadow-2xl relative flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // -----------------------------------------------------------------------------
        // 0. ÂÖßÂª∫ÂúñÊ®ôÂÖÉ‰ª∂
        // -----------------------------------------------------------------------------
        const Icons = {
            Scale: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2v2H3z"/><path d="M19 7h2v2h-2z"/></svg>, // For Law/Civics
            TrendingUp: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>, // For Economics
            Users: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>, // For Society
            Vote: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 12 2 2 4-4"/><path d="M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z"/><path d="M22 19H2"/></svg>, // For Politics
            Home: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Grid: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Flag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>,
            ChevronLeft: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>,
            Award: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            XCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>,
            RotateCcw: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Zap: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Tag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94 .94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>
        };

        const { Scale, TrendingUp, Users, Vote, Home, Grid, Flag, ChevronLeft, ChevronRight, Award, XCircle, RotateCcw, Zap, Tag } = Icons;

        // -----------------------------------------------------------------------------
        // 1. ÁúüÂØ¶È°åÂ∫´ÁØÑ‰æã (Real Questions)
        // -----------------------------------------------------------------------------
        const REAL_QUESTION_EXAMPLES = [
            {
                id: 'real_civics_1',
                type: 'single',
                category: 'Á∂ìÊøüÂ≠∏',
                text: 'Áï∂ÊüêÂúãÁôºÁîüÂö¥ÈáçË±¨ÁòüÁñ´ÊÉÖÔºåÂ∞éËá¥Ë±¨ËÇâ‰æõÁµ¶Â§ßÂπÖÊ∏õÂ∞ë„ÄÇÂú®ÂÖ∂‰ªñÊ¢ù‰ª∂‰∏çËÆäÁöÑÊÉÖÊ≥Å‰∏ãÔºå‰∏ãÂàóÈóúÊñºË±¨ËÇâÂ∏ÇÂ†¥ÁöÑÊïòËø∞Ôºå‰ΩïËÄÖÊ≠£Á¢∫Ôºü',
                options: [
                    '‰æõÁµ¶Êõ≤Á∑öÂêëÂè≥ÁßªÂãïÔºåÂùáË°°ÂÉπÊ†º‰∏ãË∑å',
                    '‰æõÁµ¶Êõ≤Á∑öÂêëÂ∑¶ÁßªÂãïÔºåÂùáË°°ÂÉπÊ†º‰∏äÊº≤',
                    'ÈúÄÊ±ÇÊõ≤Á∑öÂêëÂ∑¶ÁßªÂãïÔºåÂùáË°°Êï∏ÈáèÊ∏õÂ∞ë',
                    'ÈúÄÊ±ÇÊõ≤Á∑öÂêëÂè≥ÁßªÂãïÔºåÂùáË°°ÂÉπÊ†º‰∏äÊº≤'
                ],
                correctAnswer: [1],
                explanation: 'Áñ´ÊÉÖÂ∞éËá¥‰æõÁµ¶Ê∏õÂ∞ëÔºå‰æõÁµ¶Êõ≤Á∑öÂêëÂ∑¶ÁßªÂãï(S1->S2)ÔºåÂú®ÈúÄÊ±Ç‰∏çËÆä‰∏ãÔºåÊúÉÈÄ†ÊàêÂùáË°°ÂÉπÊ†º‰∏äÊº≤ÔºåÂùáË°°Êï∏ÈáèÊ∏õÂ∞ë„ÄÇ',
                difficulty: 'Êòì'
            },
            {
                id: 'real_civics_2',
                type: 'single',
                category: 'Ê≥ïÂæã (Ê∞ëÊ≥ï)',
                text: 'Â∞èÊòé‰ªäÂπ¥ 19 Ê≠≤ÔºåÊú™Â©öÔºåÂú®Êú™Á∂ìÁà∂ÊØçÂêåÊÑè‰∏ãÔºåË≥ºË≤∑‰∫Ü‰∏ÄËºõÂÉπÂÄº 50 Ëê¨ÂÖÉÁöÑÈáçÂûãÊ©üËªä„ÄÇ‰æùÊìöÊàëÂúãÁèæË°å„ÄäÊ∞ëÊ≥ï„ÄãÔºåÊ≠§Ê≥ïÂæãË°åÁÇ∫‰πãÊïàÂäõÁÇ∫‰ΩïÔºü',
                options: [
                    'ÁÑ°ÊïàÔºåÂõ†ÁÇ∫Êú™Êªø 20 Ê≠≤',
                    'ÊïàÂäõÊú™ÂÆöÔºåÈúÄÊ≥ïÂÆö‰ª£ÁêÜ‰∫∫ÊâøË™çÊâçÊúâÊïà',
                    'ÊúâÊïàÔºåÂõ†ÁÇ∫Â∞èÊòéÂ∑≤Êªø 18 Ê≠≤ÔºåÁÇ∫ÂÆåÂÖ®Ë°åÁÇ∫ËÉΩÂäõ‰∫∫',
                    'ÂæóÊí§Èä∑ÔºåÂõ†ÁÇ∫ÈáëÈ°çÈÅéÂ§ßÈ°Ø‰∏çÁõ∏Áï∂'
                ],
                correctAnswer: [2],
                explanation: 'ÊàëÂúã„ÄäÊ∞ëÊ≥ï„ÄãÂ∑≤‰øÆÊ≠£ÊàêÂπ¥Âπ¥ÈΩ°ÁÇ∫ 18 Ê≠≤„ÄÇÂ∞èÊòé 19 Ê≠≤Â∑≤Â±¨ÂÆåÂÖ®Ë°åÁÇ∫ËÉΩÂäõ‰∫∫ÔºåÂÖ∂Ê≥ïÂæãË°åÁÇ∫ÂÆåÂÖ®ÊúâÊïàÔºåÁÑ°ÈúÄÁà∂ÊØçÂêåÊÑè„ÄÇ',
                difficulty: '‰∏≠'
            },
            {
                id: 'real_civics_3',
                type: 'single',
                category: 'ÊîøÊ≤ª (ÊîøÂ∫úÈ´îÂà∂)',
                text: 'ÊüêÂúãÂØ¶ÊñΩÂÖßÈñ£Âà∂Ôºå‰∏ãÂàóÈóúÊñºË©≤ÂúãÊîøÊ≤ªÈÅã‰ΩúÁöÑÊïòËø∞Ôºå‰ΩïËÄÖÊúÄÂèØËÉΩÁôºÁîüÔºü',
                options: [
                    'Á∏ΩÁµ±Áî±‰∫∫Ê∞ëÁõ¥Êé•ÈÅ∏ËàâÁî¢ÁîüÔºå‰∏¶ÊéåÊè°ÊúÄÈ´òË°åÊîøÊ¨ä',
                    'Ë°åÊîøÈ¶ñÈï∑ÔºàÁ∏ΩÁêÜÔºâÊúâÊ¨äËß£Êï£ÂúãÊúÉ',
                    'Ë°åÊîøÈÉ®ÈñÄËàáÁ´ãÊ≥ïÈÉ®ÈñÄÂÆåÂÖ®ÂàÜÁ´ãÔºå‰∫í‰∏çÂà∂Ë°°',
                    'ÂúãÊúÉË≠∞Âì°‰∏çÂæóÂÖº‰ªªÂÖßÈñ£Èñ£Âì°'
                ],
                correctAnswer: [1],
                explanation: 'ÂÖßÈñ£Âà∂ÁâπÂæµÔºöË°åÊîøÈ¶ñÈï∑Áî±ÂúãÊúÉÂ§öÊï∏Èª®È†òË¢ñÊìî‰ªªÔºåË°åÊîøËàáÁ´ãÊ≥ïÊ¨äËûçÂêà„ÄÇÁ∏ΩÁêÜÊúâÊ¨äËß£Êï£ÂúãÊúÉÔºåÂúãÊúÉÂèØÂ∞çÂÖßÈñ£Êèê‰∏ç‰ø°‰ªªÊ°à„ÄÇAÊòØÁ∏ΩÁµ±Âà∂ÔºåDÊòØÁ∏ΩÁµ±Âà∂ÁâπÂæµ(Ê¨äÂäõÂàÜÁ´ã)„ÄÇ',
                difficulty: '‰∏≠'
            },
            {
                id: 'real_civics_4',
                type: 'group',
                category: 'Ê∑∑ÂêàÈ°å (‰∫∫Ê¨ä)',
                passageTitle: 'Â±Ö‰ΩèÊ≠£Áæ©ËàáËø´ÈÅ∑',
                passageContent: `ÊüêÂ∏ÇÊîøÂ∫úÁÇ∫ËààÂª∫ÁßëÊäÄÂúíÂçÄÔºåË®àÁï´ÂæµÊî∂Â∏ÇÈÉäËæ≤Âú∞‰∏¶ÊãÜÈÅ∑Áï∂Âú∞ËÅöËêΩ„ÄÇÂ±ÖÊ∞ëÊäóË≠∞ÊîøÂ∫úÊú™Á∂ìÂÖÖÂàÜÊ∫ùÈÄöÂç≥Âº∑Ë°åÂæµÊî∂Ôºå‰∏îË£úÂÑüÈáëÈÅé‰ΩéÔºå‰æµÂÆ≥ÂÖ∂ÁîüÂ≠òÊ¨äËàáÂ±Ö‰ΩèÊ¨ä„ÄÇÊîøÂ∫úÂâáÂõûÊáâÊòØÁÇ∫‰∫ÜÂÖ¨ÂÖ±Âà©ÁõäËàáÁ∂ìÊøüÁôºÂ±ï„ÄÇ`,
                questions: [
                    {
                        id: 'real_civics_4_1',
                        type: 'single',
                        text: 'ÊîøÂ∫úÂæµÊî∂ÂúüÂú∞ÁöÑË°åÁÇ∫Ôºå‰∏ªË¶ÅÊ∂âÂèäÊÜ≤Ê≥ïÁ¨¨ 23 Ê¢ù‰∏≠ÁöÑÂì™‰∏ÄÈ†ÖÂÖ¨ÁõäÂéüÂâáÔºü',
                        options: [
                            'Â¢ûÈÄ≤ÂÖ¨ÂÖ±Âà©Áõä',
                            'ÈÅøÂÖçÁ∑äÊÄ•Âç±Èõ£',
                            'Á∂≠ÊåÅÁ§æÊúÉÁß©Â∫è',
                            'Èò≤Ê≠¢Â¶®Á§ô‰ªñ‰∫∫Ëá™Áî±'
                        ],
                        correctAnswer: [0],
                        explanation: 'ÂæµÊî∂ÂúüÂú∞ÈÄöÂ∏∏ÊòØ‰ª•„ÄåÂ¢ûÈÄ≤ÂÖ¨ÂÖ±Âà©Áõä„Äç(Â¶ÇÁ∂ìÊøüÁôºÂ±ï„ÄÅÂÖ¨ÂÖ±Âª∫Ë®≠) ÁÇ∫ÁêÜÁî±„ÄÇ',
                        difficulty: 'Êòì'
                    },
                    {
                        id: 'real_civics_4_2',
                        type: 'single',
                        text: 'Ëã•Â±ÖÊ∞ëË™çÁÇ∫ÂæµÊî∂Á®ãÂ∫èÈÅïÊ≥ïÔºåÊ¨≤ÊèêËµ∑Ë°åÊîøÊïëÊøüÔºå‰∏ãÂàóÈ†ÜÂ∫è‰ΩïËÄÖÊ≠£Á¢∫Ôºü',
                        options: [
                            'Ë´ãÈ°ò ‚Üí Ë®¥È°ò ‚Üí Ë°åÊîøË®¥Ë®ü',
                            'Ë®¥È°ò ‚Üí Ë°åÊîøË®¥Ë®ü',
                            'Ê∞ë‰∫ãË®¥Ë®ü ‚Üí Ë°åÊîøË®¥Ë®ü',
                            'ÂêëÁõ£ÂØüÈô¢Èô≥ÊÉÖ ‚Üí ÊÜ≤Ê≥ïË®¥Ë®ü'
                        ],
                        correctAnswer: [1],
                        explanation: 'Â∞çË°åÊîøËôïÂàÜ‰∏çÊúçÔºåÊáâÂÖàÊèêËµ∑„ÄåË®¥È°ò„ÄçÔºåËã•‰∏çÊúçË®¥È°òÊ±∫ÂÆöÔºåÂÜçÊèêËµ∑„ÄåË°åÊîøË®¥Ë®ü„Äç„ÄÇ',
                        difficulty: '‰∏≠'
                    }
                ]
            }
        ];

        // -----------------------------------------------------------------------------
        // 2. ÂÖ¨Ê∞ëÈ°åÂ∫´Áî¢ÁîüÂô®Ë≥áÊñôÂ∫´ (Expanded Database)
        // -----------------------------------------------------------------------------

        // Á∂ìÊøüÂ≠∏Ê®°ÁµÑ
        const ECON_CONCEPTS = [
            { topic: '‰æõÈúÄÊ≥ïÂâá', q: 'Ëã•ÊîøÂ∫úÂ∞çÁèçÁè†Â•∂Ëå∂Ë®≠ÂÆö„ÄåÂÉπÊ†º‰∏ãÈôê„Äç(Price Floor) ‰∏îÈ´òÊñºÂùáË°°ÂÉπÊ†ºÔºåÂ∏ÇÂ†¥Â∞áÂá∫Áèæ‰ΩïÁ®ÆÊÉÖÊ≥ÅÔºü', ans: 'Ë∂ÖÈ°ç‰æõÁµ¶ (Surplus)', opts: ['Ë∂ÖÈ°çÈúÄÊ±Ç (Shortage)', 'Â∏ÇÂ†¥ÂùáË°°', 'ÈªëÂ∏Ç‰∫§Êòì'] },
            { topic: 'GDPË®àÁÆó', q: '‰∏ãÂàó‰ΩïËÄÖÊáâË®àÂÖ•Âè∞ÁÅ£Áï∂Âπ¥Â∫¶ÁöÑ GDPÔºü', ans: 'Âè∞Á©çÈõªÂú®Âè∞ÁÅ£ÁîüÁî¢ÁöÑÊô∂ÁâáÁî¢ÂÄº', opts: ['Âè∞ÁÅ£‰∫∫Âú®ÁæéÂúãÈñãÈ§êÂª≥ÁöÑÊî∂ÂÖ•(GNP)', 'ÂÆ∂Â∫≠‰∏ªÂ©¶Âú®ÂÆ∂ÂÅöÁöÑÂÆ∂‰∫ã(ÁÑ°Â∏ÇÂ†¥‰∫§Êòì)', '‰∫åÊâãËªäÂïÜËΩâË≥£ËàäËªäÁöÑÂÉπÈáë(ÈùûÁï∂ÊúüÁîüÁî¢)'] },
            { topic: 'Â§ñÈÉ®ÊÄß', q: 'Â∑•Âª†ÊéíÊîæÂª¢Ê∞¥Ê±ôÊüìÊ≤≥Â∑ùÔºåÂ∞éËá¥‰∏ãÊ∏∏ÊºÅÊ∞ëÊºÅÁç≤Ê∏õÂ∞ë„ÄÇÈÄôÂú®Á∂ìÊøüÂ≠∏‰∏äÁ®±ÁÇ∫Ôºü', ans: 'Â§ñÈÉ®ÊàêÊú¨ (Ë≤†Èù¢Â§ñÈÉ®ÊÄß)', opts: ['Â§ñÈÉ®ÊïàÁõä', 'ÂÖ¨ÂÖ±Ë≤°', 'Ë≥áË®ä‰∏çÂ∞çÁ®±'] },
            { topic: 'Ê©üÊúÉÊàêÊú¨', q: 'Â∞èËèØÊîæÊ£ÑÊôÇËñ™160ÂÖÉÁöÑÊâìÂ∑•ÔºåÈÅ∏ÊìáÂéªÁúã‰∏ÄÂ†¥Á•®ÂÉπ300ÂÖÉÁöÑÈõªÂΩ±(ÈúÄËÄóÊôÇ2Â∞èÊôÇ)„ÄÇË´ãÂïè‰ªñÁúãÈõªÂΩ±ÁöÑÊ©üÊúÉÊàêÊú¨ÊòØÂ§öÂ∞ëÔºü', ans: '620ÂÖÉ (300+160*2)', opts: ['300ÂÖÉ', '320ÂÖÉ', '460ÂÖÉ'] }, // Á•®ÂÉπ+Â∞ëË≥∫ÁöÑÈå¢
            { topic: 'ÊØîËºÉÂà©Áõä', q: '‰æùÊìöÊØîËºÉÂà©ÁõäÊ≥ïÂâáÔºåÂúãËàáÂúã‰πãÈñìÈÄ≤Ë°åË≤øÊòìÁöÑÂü∫Á§éÊòØÔºü', ans: 'ÁîüÁî¢Ê©üÊúÉÊàêÊú¨ËºÉ‰ΩéÁöÑÁî¢ÂìÅ', opts: ['ÁîüÁî¢ÂäõÊúÄÈ´òÁöÑÁî¢ÂìÅ', 'ÁîüÁî¢Âà©ÊΩ§ÊúÄÈ´òÁöÑÁî¢ÂìÅ', 'ÊìÅÊúâÁµïÂ∞çÂà©ÁõäÁöÑÁî¢ÂìÅ'] }
        ];

        // Ê≥ïÂæãÊ®°ÁµÑ (ÂåÖÂê´18Ê≠≤ÊàêÂπ¥Êñ∞Âà∂)
        const LAW_CONCEPTS = [
            { topic: 'Ë≤¨‰ªªËÉΩÂäõ', q: 'Â∞èÊòé‰ªäÂπ¥ 15 Ê≠≤ÔºåÂú®Â≠∏Ê†°ËàáÂêåÂ≠∏ÊâìÊû∂ÈÄ†ÊàêÂ∞çÊñπÂèóÂÇ∑„ÄÇÈóúÊñºÂÖ∂Ê≥ïÂæãË≤¨‰ªªÔºå‰∏ãÂàó‰ΩïËÄÖÊ≠£Á¢∫Ôºü', ans: 'ÂÖ∑ÊúâÈôêÂà∂Ë≤¨‰ªªËÉΩÂäõÔºåÂæóÊ∏õËºïÂÖ∂Âàë', opts: ['ÁÑ°Ë≤¨‰ªªËÉΩÂäõÔºå‰∏çÁΩ∞', 'ÁÇ∫ÂÆåÂÖ®Ë≤¨‰ªªËÉΩÂäõ‰∫∫ÔºåË≤†ÂÖ®Ë≤¨', 'ÂÉÖË≤†Ê∞ë‰∫ãË≥†ÂÑüË≤¨‰ªªÔºåÁÑ°Âàë‰∫ãË≤¨‰ªª'] },
            { topic: 'Ê∞ëÊ≥ïË°åÁÇ∫ËÉΩÂäõ', q: '‰æùÊìöÁèæË°åÊ∞ëÊ≥ïÔºåÂπæÊ≠≤ÁÇ∫ÂÆåÂÖ®Ë°åÁÇ∫ËÉΩÂäõ‰∫∫ÔºåÂèØÁç®Á´ãÁ∞ΩË®ÇÂ•ëÁ¥ÑÔºü', ans: '18 Ê≠≤', opts: ['20 Ê≠≤', '16 Ê≠≤', '21 Ê≠≤'] },
            { topic: 'Ê¨äÂà©ÊïëÊøü', q: 'Â∞èÁæéËàáÊàøÊù±ÁôºÁîüÁßüÂ±ãÁ≥æÁ¥õÔºåÈõôÊñπ‰∏çÊÉ≥‰∏äÊ≥ïÈô¢ÔºåÂèØÂ∞ãÊ±Ç‰∏ãÂàó‰ΩïÁ®ÆÈÄîÂæëËß£Ê±∫Ôºü', ans: 'ÂêëÈÑâÈéÆÂ∏ÇÂçÄÂÖ¨ÊâÄÁî≥Ë´ãË™øËß£', opts: ['ÂêëË≠¶ÂØüÂ±ÄÂ†±Ê°à', 'ÂêëÊ™¢ÂØüÂÆòÊèêËµ∑ÂÖ¨Ë®¥', 'Áî≥Ë´ãÈáãÊÜ≤'] },
            { topic: 'Ë°åÊîøÊ≥ï', q: '‰∏ãÂàó‰ΩïËÄÖÂ±¨ÊñºË°åÊîøËôïÂàÜÔºü', ans: 'Ë°õÁîüÂ±ÄÂ∞çÈ§êÂª≥ÈñãÂá∫ÁöÑÁΩ∞ÂñÆ', opts: ['Ê∞£Ë±°Â±ÄÁôºÂ∏ÉÈ¢±È¢®Ë≠¶Â†±(‰∫ãÂØ¶Ë°åÁÇ∫)', 'Ë°åÊîøÊ©üÈóúÂÖßÈÉ®ÁöÑÂÖ¨ÊñáÂæÄ‰æÜ', 'Â∏ÇÊîøÂ∫úËàáÂª†ÂïÜÁ∞ΩË®ÇÊé°Ë≥ºÂ•ëÁ¥Ñ(Ë°åÊîøÂ•ëÁ¥Ñ)'] },
            { topic: 'ÊÜ≤Ê≥ïÊ¨äÂà©', q: 'ÊîøÂ∫úÈôêÂà∂‰∫∫Ê∞ëË®ÄË´ñËá™Áî±ÔºåÂøÖÈ†àÁ¨¶ÂêàÊÜ≤Ê≥ïÁ¨¨23Ê¢ùÁöÑÊØî‰æãÂéüÂâá„ÄÇ‰∏ãÂàó‰ΩïËÄÖ„Äå‰∏ç„ÄçÊòØÊØî‰æãÂéüÂâáÁöÑÂ≠êÂéüÂâáÔºü', ans: 'Ë™†ÂØ¶‰ø°Áî®ÂéüÂâá', opts: ['ÈÅ©Áï∂ÊÄßÂéüÂâá', 'ÂøÖË¶ÅÊÄßÂéüÂâá', 'Ë°°ÈáèÊÄßÂéüÂâá(ÁãπÁæ©ÊØî‰æãÂéüÂâá)'] }
        ];

        // ÊîøÊ≤ªÊ®°ÁµÑ
        const POL_CONCEPTS = [
            { topic: 'ÈÅ∏ËàâÂà∂Â∫¶', q: 'ÊàëÂúãÁ´ãÊ≥ïÂßîÂì°ÈÅ∏ËàâÊé°Ë°åÁöÑÂà∂Â∫¶ÁÇ∫‰ΩïÔºü', ans: 'ÂñÆ‰∏ÄÈÅ∏ÂçÄÂÖ©Á•®Âà∂ (‰∏¶Á´ãÂà∂)', opts: ['Ë§áÊï∏ÈÅ∏ÂçÄÂñÆË®òÊ≥ï', 'ÂñÆ‰∏ÄÈÅ∏ÂçÄÂÖ©Á•®Âà∂ (ËÅØÁ´ãÂà∂)', 'ÊØî‰æã‰ª£Ë°®Âà∂'] },
            { topic: 'ÊîøÂ∫úÈ´îÂà∂', q: '‰∏ãÂàó‰ΩïËÄÖÊòØ„ÄåÁ∏ΩÁµ±Âà∂„ÄçÁöÑÁâπÂæµÔºü', ans: 'Á∏ΩÁµ±ÂÖ∑ÊúâË¶ÜË≠∞Ê¨äÔºåÂèØÂê¶Ê±∫ÂúãÊúÉÊ≥ïÊ°à', opts: ['Ë°åÊîøÈ¶ñÈï∑ÂèØËß£Êï£ÂúãÊúÉ', 'ÂúãÊúÉÂèØÂ∞çË°åÊîøÈ¶ñÈï∑Êèê‰∏ç‰ø°‰ªªÊ°à', 'Ë°åÊîøÈ¶ñÈï∑Áî±ÂúãÊúÉÈÅ∏Âá∫'] },
            { topic: 'ÂúãÈöõÈóú‰øÇ', q: 'ÈóúÊñºËÅØÂêàÂúã (UN)Ôºå‰∏ãÂàóÊïòËø∞‰ΩïËÄÖÊ≠£Á¢∫Ôºü', ans: 'ÂÆâÂÖ®ÁêÜ‰∫ãÊúÉÁöÑ5ÂÄãÂ∏∏‰ªªÁêÜ‰∫ãÂúãÊìÅÊúâÂê¶Ê±∫Ê¨ä', opts: ['ÁßòÊõ∏Èï∑Áî±Â∏∏‰ªªÁêÜ‰∫ãÂúãËº™ÊµÅÊìî‰ªª', 'ÊâÄÊúâÊ±∫Ë≠∞Â∞çÊúÉÂì°ÂúãÁöÜÊúâÊ≥ïÂæãÊãòÊùüÂäõ', 'ÊàëÂúãÁõÆÂâçÊòØ‰ª•ËßÄÂØüÂì°Ë∫´ÂàÜÂèÉËàá'] },
            { topic: 'ÂÖ¨Ê∞ëÊäïÁ•®', q: '‰æùÊìöÊàëÂúãÂÖ¨ÊäïÊ≥ïÔºåÂÖ¨Ê∞ëÊäïÁ•®ÁöÑÊèêÊ°à‰∫∫Âπ¥ÈΩ°ÈñÄÊ™ªÁÇ∫‰ΩïÔºü', ans: '18 Ê≠≤', opts: ['20 Ê≠≤', '21 Ê≠≤', '16 Ê≠≤'] },
            { topic: 'Âü∫Êú¨‰∫∫Ê¨ä', q: 'Âº∑Ë™øÂúãÂÆ∂ÊáâÁ©çÊ•µ‰ªãÂÖ•Ôºå‰øùÈöú‰∫∫Ê∞ë‰∫´ÊúâÊïôËÇ≤„ÄÅÂ∑•‰Ωú„ÄÅÁ§æÊúÉÁ¶èÂà©Á≠âÊ¨äÂà©ÔºåÂ±¨ÊñºÁ¨¨Âπæ‰ª£‰∫∫Ê¨äÔºü', ans: 'Á¨¨‰∫å‰ª£‰∫∫Ê¨ä (Á§æÊúÉÊ¨ä)', opts: ['Á¨¨‰∏Ä‰ª£‰∫∫Ê¨ä (Ëá™Áî±Ê¨ä)', 'Á¨¨‰∏â‰ª£‰∫∫Ê¨ä (ÈõÜÈ´îÊ¨ä)', 'Á¨¨Âõõ‰ª£‰∫∫Ê¨ä (Ë≥áË®äÊ¨ä)'] }
        ];

        // Á§æÊúÉÊ®°ÁµÑ
        const SOC_CONCEPTS = [
            { topic: 'Â™íÈ´îË≠òËÆÄ', q: 'Â™íÈ´îÂú®Â†±Â∞éÊñ∞ËÅûÊôÇÔºåÂàªÊÑèÈÅ∏ÂèñÁâπÂÆöËßíÂ∫¶ÊàñÂøΩÁï•ÈÉ®ÂàÜ‰∫ãÂØ¶ÔºåÂºïÂ∞éÈñ±ËÅΩ‰∫∫Áî¢ÁîüÁâπÂÆöËßÄÈªûÔºåÁ®±ÁÇ∫Ôºü', ans: 'Â™íÈ´îÊ°ÜÊû∂ (Framing)', opts: ['Â™íÈ´îËøëÁî®Ê¨ä', 'ÂÆàÈñÄ‰∫∫Ê©üÂà∂', 'ÁΩÆÂÖ•ÊÄßË°åÈä∑'] },
            { topic: 'ÊÄßÂà•Âπ≥Á≠â', q: 'ÁéªÁíÉÂ§©Ëä±ÊùøÊïàÊáâ (Glass Ceiling) ÈÄöÂ∏∏Áî®‰æÜÂΩ¢ÂÆπÔºü', ans: 'Â•≥ÊÄßÂú®ËÅ∑Â†¥ÂçáÈÅ∑‰∏äÈÅáÂà∞ÁÑ°ÂΩ¢ÁöÑÈöúÁ§ô', opts: ['Â•≥ÊÄßËñ™Ë≥áÈ´òÊñºÁî∑ÊÄß', 'ËÅ∑Â†¥ÊÄßÈ®∑ÊìæÈò≤Ê≤ª', 'ÊÄßÂà•ÂàªÊùøÂç∞Ë±°ÁöÑÊ∂àÈô§'] },
            { topic: 'Á§æÊúÉÈöéÂ±§', q: '‰∏ÄÂÄã‰∫∫ÁöÑÁ§æÊúÉÂú∞‰ΩçËã•ÊòØÈÄèÈÅéÂÄã‰∫∫Âä™Âäõ„ÄÅÂèóÊïôËÇ≤ËÄåÂèñÂæóÔºåÁ®±ÁÇ∫Ôºü', ans: 'ÊàêÂ∞±Âú∞‰Ωç', opts: ['Ê≠∏Â±¨Âú∞‰Ωç', '‰∏ñË•≤Âú∞‰Ωç', 'ÂÖàÂ§©Âú∞‰Ωç'] },
            { topic: 'ÊñáÂåñÊ¶ÇÂøµ', q: 'Ë™çÁÇ∫Ëá™Â∑±ÁöÑÊñáÂåñÊúÄÂÑ™ÁßÄÔºå‰∏¶‰ª•Ëá™Ë∫´ÊñáÂåñÊ®ôÊ∫ñË©ïÊñ∑ÂÖ∂‰ªñÊñáÂåñÔºåÁ®±ÁÇ∫Ôºü', ans: 'ÊàëÊóè‰∏≠ÂøÉ‰∏ªÁæ©', opts: ['ÊñáÂåñÁõ∏Â∞çË´ñ', 'Â§öÂÖÉÊñáÂåñ‰∏ªÁæ©', 'ÊñáÂåñ‰ΩçÈöé'] },
            { topic: 'ÂÖ¨ÂÖ±Âà©Áõä', q: '„ÄåÊê≠‰æøËªäÈõ£È°å„Äç(Free-rider problem) ÊúÄÂ∏∏Âá∫ÁèæÂú®Âì™Á®ÆË≤°Ë≤®‰∏äÔºü', ans: 'ÂÖ¨ÂÖ±Ë≤° (Â¶ÇÂúãÈò≤„ÄÅË∑ØÁáà)', opts: ['ÁßÅÊúâË≤°', 'Ê∫ñÁßÅÊúâË≤°', '‰ø±Ê®ÇÈÉ®Ë≤°'] }
        ];

        // -----------------------------------------------------------------------------
        // Helper: Fisher-Yates Shuffle
        // -----------------------------------------------------------------------------
        const fisherYatesShuffle = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        // -----------------------------------------------------------------------------
        // Generator Logic
        // -----------------------------------------------------------------------------
        const generateCivicsMock = (category, itemIndex, variantCount) => {
            const shuffle = (arr) => [...arr].sort(() => 0.5 - Math.random());
            const isReview = variantCount > 0;
            const reviewLabel = isReview ? '„Äêüí°Ë§áÁøíËÆäÈ´î„Äë' : '';

            let db, icon, colorClass, categoryName;

            switch(category) {
                case 'econ': 
                    db = ECON_CONCEPTS; 
                    icon = <Icons.TrendingUp size={16} />; 
                    colorClass = "text-emerald-700 bg-emerald-100";
                    categoryName = "Á∂ìÊøü";
                    break;
                case 'law': 
                    db = LAW_CONCEPTS; 
                    icon = <Icons.Scale size={16} />; 
                    colorClass = "text-rose-700 bg-rose-100";
                    categoryName = "Ê≥ïÂæã";
                    break;
                case 'pol': 
                    db = POL_CONCEPTS; 
                    icon = <Icons.Vote size={16} />; 
                    colorClass = "text-blue-700 bg-blue-100";
                    categoryName = "ÊîøÊ≤ª";
                    break;
                case 'soc': 
                    db = SOC_CONCEPTS; 
                    icon = <Icons.Users size={16} />; 
                    colorClass = "text-amber-700 bg-amber-100";
                    categoryName = "Á§æÊúÉ";
                    break;
            }

            const item = db[itemIndex % db.length];
            const distractors = shuffle(item.opts);
            
            // ËÆäÈ´îÈÇèËºØÔºöÂ¶ÇÊûúÊòØË§áÁøíÈ°åÔºåÁ®çÂæÆ‰øÆÊîπÂïèÊ≥ï
            let qText = item.q;
            if (isReview) {
                if (qText.includes('‰∏ãÂàó‰ΩïËÄÖ')) qText = qText.replace('‰∏ãÂàó‰ΩïËÄÖ', 'Ë´ãÈÅ∏Âá∫');
                else qText = `(ËßÄÂøµÂº∑Âåñ) ${qText}`;
            }

            return {
                category: categoryName,
                text: `${reviewLabel} [${item.topic}] ${qText}`,
                options: [item.ans, ...distractors],
                explanation: `Ê≠£Á¢∫Á≠îÊ°àÁÇ∫„Äå${item.ans}„Äç„ÄÇÊú¨È°åËÄÉÈªûÁÇ∫Ôºö${item.topic}„ÄÇ`,
                correctIndex: 0,
                isReview,
                colorClass,
                icon
            };
        };

        const generateMockQuestions = (startId, count) => {
            const mocks = [];
            const categories = ['econ', 'law', 'pol', 'soc'];
            let taskPool = [];
            
            // Ë®àÁÆóÁ∏ΩÂü∫Á§éÈ°åÊï∏
            const totalBaseItems = ECON_CONCEPTS.length + LAW_CONCEPTS.length + POL_CONCEPTS.length + SOC_CONCEPTS.length;
            const loopsNeeded = Math.ceil(count / totalBaseItems) + 1;

            for (let loop = 0; loop < loopsNeeded; loop++) {
                categories.forEach(cat => {
                    let len = 0;
                    if(cat === 'econ') len = ECON_CONCEPTS.length;
                    if(cat === 'law') len = LAW_CONCEPTS.length;
                    if(cat === 'pol') len = POL_CONCEPTS.length;
                    if(cat === 'soc') len = SOC_CONCEPTS.length;

                    for (let i = 0; i < len; i++) {
                        taskPool.push({ cat, itemIndex: i, variantCount: loop });
                    }
                });
            }

            taskPool = fisherYatesShuffle(taskPool);
            const selectedTasks = taskPool.slice(0, count);

            selectedTasks.forEach((task, i) => {
                const content = generateCivicsMock(task.cat, task.itemIndex, task.variantCount);
                
                let finalOptions = content.options.map((text, idx) => ({ 
                    text, 
                    isCorrect: idx === content.correctIndex 
                }));
                finalOptions = fisherYatesShuffle(finalOptions);
                
                let correctIndices = [];
                finalOptions.forEach((opt, idx) => {
                    if (opt.isCorrect) correctIndices.push(idx);
                });

                const answerLabels = correctIndices.map(idx => String.fromCharCode(65 + idx)).join(', ');

                mocks.push({
                    id: `mock_civics_${startId + i}`,
                    type: 'single', 
                    category: content.category,
                    text: `[Q${startId + i}] ${content.text}`,
                    options: finalOptions.map(o => o.text),
                    correctAnswer: correctIndices,
                    explanation: `${content.explanation} (Á≠îÊ°à: ${answerLabels})`,
                    difficulty: ['Êòì', '‰∏≠', 'Èõ£'][Math.floor(Math.random() * 3)],
                    isReview: content.isReview,
                    colorClass: content.colorClass
                });
            });
            return mocks;
        };

        // -----------------------------------------------------------------------------
        // App Component
        // -----------------------------------------------------------------------------
        function CivicsApp() {
            const [currentScreen, setCurrentScreen] = useState('home'); 
            const [questions, setQuestions] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [userAnswers, setUserAnswers] = useState({});
            const [markedQuestions, setMarkedQuestions] = useState(new Set()); 
            const [showExplanation, setShowExplanation] = useState(false);
            const [showGrid, setShowGrid] = useState(false); 

            useEffect(() => {
                let flattened = [];
                REAL_QUESTION_EXAMPLES.forEach(item => {
                    if (item.type === 'group') {
                        item.questions.forEach(q => {
                            flattened.push({
                                ...q,
                                groupTitle: item.passageTitle,
                                groupContent: item.passageContent,
                                isGroup: true,
                                colorClass: "text-gray-700 bg-gray-100"
                            });
                        });
                    } else {
                        flattened.push({
                             ...item,
                             colorClass: "text-indigo-700 bg-indigo-100"
                        });
                    }
                });

                const currentCount = flattened.length;
                const needed = 500 - currentCount;
                if (needed > 0) {
                    const mocks = generateMockQuestions(currentCount + 1, needed);
                    flattened = [...flattened, ...mocks];
                }

                setQuestions(flattened);
            }, []);

            const startExam = () => {
                setCurrentQuestionIndex(0);
                setUserAnswers({});
                setMarkedQuestions(new Set());
                setShowExplanation(false);
                setShowGrid(false);
                setCurrentScreen('quiz');
            };

            const handleAnswerSelect = (optionIndex) => {
                if (showExplanation) return; 
                const currentQ = questions[currentQuestionIndex];
                setUserAnswers(prev => ({ ...prev, [currentQ.id]: [optionIndex] }));
                setShowExplanation(true);
            };

            const toggleMarkQuestion = () => {
                const qId = questions[currentQuestionIndex].id;
                setMarkedQuestions(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(qId)) newSet.delete(qId);
                    else newSet.add(qId);
                    return newSet;
                });
            };

            const calculateScore = () => {
                let rawScore = 0;
                questions.forEach(q => {
                    const userAns = userAnswers[q.id] || [];
                    const correctAns = q.correctAnswer;
                    if (userAns.length > 0 && userAns[0] === correctAns[0]) {
                        rawScore++;
                    }
                });
                const percentage = (rawScore / questions.length) * 100;
                let rank = 0;
                if (percentage >= 90) rank = 15;
                else if (percentage >= 85) rank = 14;
                else if (percentage >= 80) rank = 13;
                else if (percentage >= 70) rank = 11;
                else if (percentage >= 60) rank = 9;
                else rank = Math.floor(percentage / 10) + 1;

                return { rawScore, total: questions.length, rank, percentage };
            };

            const QuestionGrid = ({ closeGrid }) => (
                <div className="fixed inset-0 bg-black/50 z-50 flex justify-end animate-fade-in">
                    <div className="w-full max-w-md bg-white h-full shadow-2xl flex flex-col animate-slide-in-right">
                        <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                            <h3 className="font-bold text-lg text-gray-800 flex items-center font-serif">
                                <Icons.Grid size={20} className="mr-2"/> È°åÁõÆÂ∞éËà™
                            </h3>
                            <button onClick={closeGrid} className="p-2 hover:bg-gray-200 rounded-full">
                                <Icons.XCircle size={24} className="text-gray-500"/>
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4">
                            <div className="grid grid-cols-5 gap-3">
                                {questions.map((qItem, idx) => {
                                    const isAnswered = userAnswers[qItem.id] && userAnswers[qItem.id].length > 0;
                                    const isMarkedItem = markedQuestions.has(qItem.id);
                                    const isCurrent = currentQuestionIndex === idx;
                                    let btnClass = "h-10 w-10 rounded-lg flex items-center justify-center text-sm font-medium transition relative font-serif ";
                                    if (isCurrent) btnClass += "ring-2 ring-slate-600 ring-offset-2 bg-slate-200 text-slate-800 font-bold ";
                                    else if (isAnswered) btnClass += "bg-slate-600 text-white shadow-sm ";
                                    else btnClass += "bg-slate-100 text-gray-500 hover:bg-slate-200 ";

                                    return (
                                        <button 
                                            key={qItem.id} 
                                            onClick={() => { setCurrentQuestionIndex(idx); setShowExplanation(false); closeGrid(); }}
                                            className={btnClass}
                                        >
                                            {idx + 1}
                                            {isMarkedItem && <span className="absolute -top-1 -right-1 w-3 h-3 bg-rose-500 rounded-full border border-white"></span>}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (currentScreen === 'home') return (
                <div className="flex flex-col items-center justify-center h-full p-6 space-y-8 animate-fade-in bg-gradient-to-br from-slate-200 to-gray-200">
                    <div className="text-center space-y-4 max-w-lg">
                        <div className="bg-slate-700 p-6 rounded-full inline-block mb-2 shadow-xl">
                            <Icons.Scale size={64} className="text-white" />
                        </div>
                        <h1 className="text-3xl font-extrabold text-gray-800 tracking-tight font-serif">108Ë™≤Á∂± ‚Ä¢ ÂÖ¨Ê∞ëËàáÁ§æÊúÉ</h1>
                        <p className="text-lg text-gray-600 font-medium">Á§æÊúÉ ‚Ä¢ ÊîøÊ≤ª ‚Ä¢ Ê≥ïÂæã ‚Ä¢ Á∂ìÊøü</p>
                        <div className="flex flex-wrap justify-center gap-2 mt-4">
                           <span className="px-3 py-1 bg-white border border-slate-300 rounded-full text-sm text-slate-600">500È°åÂ∫´</span>
                           <span className="px-3 py-1 bg-white border border-slate-300 rounded-full text-sm text-slate-600">Á¥†È§äÂ∞éÂêë</span>
                           <span className="px-3 py-1 bg-white border border-slate-300 rounded-full text-sm text-slate-600">Èö®Ê©üËÆäÈ´î</span>
                        </div>
                    </div>
                    <div className="w-full max-w-sm">
                        <button 
                            onClick={startExam}
                            className="w-full flex items-center justify-center p-5 bg-slate-700 text-white rounded-xl shadow-lg hover:bg-slate-800 transition transform hover:-translate-y-1 group font-serif"
                        >
                            <div className="bg-white/10 p-2 rounded-full mr-3 group-hover:scale-110 transition">
                                <Icons.Zap size={24} className="text-white" />
                            </div>
                            <div className="text-left">
                                <span className="block font-bold text-xl">ÈñãÂßãÊ∏¨È©ó</span>
                                <span className="text-sm text-slate-300">Civics Practice</span>
                            </div>
                        </button>
                    </div>
                </div>
            );

            if (currentScreen === 'result') {
                const { rawScore, total, rank, percentage } = calculateScore();
                return (
                    <div className="flex flex-col items-center h-full bg-slate-100 p-6 overflow-y-auto font-serif">
                        <div className="w-full max-w-md space-y-6 mt-8">
                            <div className="bg-white rounded-3xl shadow-xl p-8 text-center relative overflow-hidden">
                                <h2 className="text-3xl font-extrabold text-slate-800 mb-2">Ê∏¨È©óÁµêÊùü</h2>
                                <div className="flex justify-center my-8">
                                    <div className="text-6xl font-black text-slate-800">{percentage.toFixed(0)}<span className="text-2xl text-slate-400 font-normal">ÂàÜ</span></div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 text-left">
                                    <div className="bg-slate-100 p-4 rounded-2xl">
                                        <p className="text-xs text-slate-500 font-bold mb-1">Á≠îÂ∞çÈ°åÊï∏</p>
                                        <p className="text-2xl font-bold text-slate-800">{rawScore} / {total}</p>
                                    </div>
                                    <div className="bg-slate-100 p-4 rounded-2xl">
                                        <p className="text-xs text-slate-500 font-bold mb-1">ÊèõÁÆóÁ¥öÂàÜ</p>
                                        <p className="text-2xl font-bold text-slate-800">{rank}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button onClick={() => setCurrentScreen('home')} className="w-full bg-slate-700 hover:bg-slate-800 text-white py-4 rounded-2xl font-bold shadow-lg transition flex items-center justify-center space-x-2">
                                    <Icons.RotateCcw size={20} /> <span>ÈáçËøîÈ¶ñÈ†Å</span>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            const q = questions[currentQuestionIndex];
            if (!q) return <div className="flex items-center justify-center h-full text-xl font-serif text-slate-500">Ë©¶Âç∑Ê∫ñÂÇô‰∏≠...</div>;

            const currentAns = userAnswers[q.id] || [];
            const isMarked = markedQuestions.has(q.id);

            return (
                <div className="flex flex-col h-full bg-slate-50 relative font-sans">
                    {showGrid && <QuestionGrid closeGrid={() => setShowGrid(false)} />}
                    
                    <div className="bg-white shadow-sm px-4 py-3 flex justify-between items-center sticky top-0 z-10 border-b border-slate-200">
                        <div className="flex items-center space-x-3">
                            <button onClick={() => setCurrentScreen('home')} className="p-2 hover:bg-slate-100 rounded-lg text-slate-500">
                                <Icons.Home size={20} />
                            </button>
                            <button onClick={() => setShowGrid(true)} className="flex items-center space-x-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 rounded-lg transition text-slate-700 font-medium">
                                <Icons.Grid size={18} />
                                <span>{currentQuestionIndex + 1} / {questions.length}</span>
                            </button>
                        </div>
                        <button onClick={toggleMarkQuestion} className={`p-2 rounded-lg transition ${isMarked ? 'bg-rose-100 text-rose-500' : 'text-slate-400 hover:bg-slate-100'}`}>
                            <Icons.Flag size={20} fill={isMarked ? "currentColor" : "none"} />
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 md:p-6 max-w-4xl mx-auto w-full scroll-smooth">
                        {q.isGroup && (
                            <div className="bg-slate-100 rounded-xl p-6 mb-6 shadow-sm border-l-4 border-slate-500">
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="font-bold text-lg text-slate-900">{q.groupTitle}</h3>
                                    <span className="text-xs bg-slate-200 text-slate-700 px-2 py-1 rounded">È°åÁµÑ</span>
                                </div>
                                <div className="prose prose-slate max-w-none text-slate-800 leading-relaxed text-base">
                                    {q.groupContent}
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-xl p-6 shadow-sm ring-1 ring-slate-200">
                            <div className="flex items-center space-x-2 mb-4">
                                <span className={`text-xs font-bold px-2 py-1 rounded bg-slate-200 text-slate-800`}>
                                    ÂñÆÈÅ∏È°å
                                </span>
                                <span className={`text-xs px-2 py-1 rounded border ${q.colorClass || 'text-gray-500 bg-gray-100 border-gray-200'}`}>
                                    {q.category}
                                </span>
                                {q.isReview && <span className="text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-200 flex items-center animate-pulse"><Icons.Tag size={12} className="mr-1" /> Ë§áÁøíËÆäÈ´î</span>}
                            </div>

                            <h2 className="text-xl font-medium text-slate-900 mb-8 leading-relaxed whitespace-pre-wrap">
                                {q.text}
                            </h2>

                            <div className="space-y-4">
                                {q.options.map((option, idx) => {
                                    const isSelected = currentAns.includes(idx);
                                    let btnClass = "w-full text-left p-4 rounded-xl border transition-all flex items-start space-x-4 relative overflow-hidden ";
                                    if (showExplanation) {
                                        if (q.correctAnswer.includes(idx)) btnClass += "border-emerald-600 bg-emerald-50 text-emerald-900";
                                        else if (isSelected) btnClass += "border-rose-500 bg-rose-50 text-rose-900";
                                        else btnClass += "border-slate-100 text-slate-400 opacity-60";
                                    } else {
                                        if (isSelected) btnClass += "border-slate-600 bg-slate-100 text-slate-900 shadow-md";
                                        else btnClass += "border-slate-200 hover:border-slate-400 hover:bg-slate-50 text-slate-700";
                                    }

                                    return (
                                        <button key={idx} onClick={() => handleAnswerSelect(idx)} className={btnClass} disabled={showExplanation}>
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold border transition-colors ${
                                                isSelected ? 'bg-slate-700 border-slate-700 text-white' : 'border-slate-300 text-slate-500'
                                            } ${showExplanation && q.correctAnswer.includes(idx) ? '!bg-emerald-600 !border-emerald-600 !text-white' : ''}`}>
                                                {String.fromCharCode(65 + idx)}
                                            </div>
                                            <span className="pt-1 text-lg">{option}</span>
                                        </button>
                                    );
                                })}
                            </div>

                            {showExplanation && (
                                <div className="mt-8 bg-blue-50 p-5 rounded-xl border border-blue-100 animate-fade-in-up">
                                    <div className="flex items-center space-x-2 text-blue-900 font-bold mb-3">
                                        <Icons.Award size={20} />
                                        <span>Ëß£Êûê</span>
                                    </div>
                                    <p className="text-blue-900 leading-relaxed">{q.explanation}</p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="bg-white border-t border-slate-200 p-4 flex justify-between items-center safe-area-bottom">
                        <button 
                            onClick={() => { setShowExplanation(false); setCurrentQuestionIndex(prev => Math.max(0, prev - 1)); }}
                            disabled={currentQuestionIndex === 0}
                            className="flex items-center space-x-2 px-4 py-2 rounded-full text-slate-600 hover:bg-slate-100 disabled:opacity-30 transition"
                        >
                            <Icons.ChevronLeft size={20} /> <span>‰∏ä‰∏ÄÈ°å</span>
                        </button>
                        
                        <button 
                            onClick={() => {
                                if (currentQuestionIndex < questions.length - 1) { setShowExplanation(false); setCurrentQuestionIndex(prev => prev + 1); } 
                                else { setCurrentScreen('result'); setShowGrid(false); }
                            }}
                            className="bg-slate-700 hover:bg-slate-800 text-white px-8 py-2.5 rounded-full font-bold shadow-md flex items-center transition"
                        >
                            {currentQuestionIndex === questions.length - 1 ? 'ÂÆåÊàê' : '‰∏ã‰∏ÄÈ°å'} <Icons.ChevronRight size={18} className="ml-1"/>
                        </button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CivicsApp />);
    </script>
</body>
</html>